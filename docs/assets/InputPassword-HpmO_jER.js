import{u as e}from"./vue-router-CV1PYoGq.js";import{u as a}from"./username-Dv10iimS.js";import{u as r}from"./jwtToken-BtJostrG.js";import{u as t}from"./user-CQNUL1T8.js";import{l as s,a as o}from"./user-xCAwdfj3.js";import{d as l,h as i,r as n,S as d,e as u,bI as m,z as f,bB as p,bC as c,bv as v,V as _,u as w,bL as g,bM as h}from"./vendor-CKpYW6Oo.js";import{_ as j}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./pinia-DPBO3wPh.js";import"./request-Be5djaOi.js";const b={ref:"signFormRef",class:"sign-in-container form-container half-width"},y=j(l({__name:"InputPassword",setup(l){const j=e(),y=a(),P=t(),k=r(),I=i("idle"),U=i(),x=n({id:void 0,password:"",role:"student"});d((()=>{x.id=y.Id}));const E=u((()=>!(x.id&&x.password))),B={id:[{validator:async function(e,a){return""===a?Promise.reject(new Error("请输入账号！")):""!==a&&"fail"===I.value?Promise.reject(new Error("账号不存在！")):Promise.resolve()},trigger:"blur"}],password:[{validator:async function(e,a){return""===a?Promise.reject(new Error("请输入密码！")):""!==a&&"fail"===I.value?Promise.reject(new Error("密码错误！")):Promise.resolve()},trigger:"blur"}]};async function z(){try{const e="teacher"===x.role?await s({teacherId:x.id,password:x.password}):await o({studentId:x.id,password:x.password});if(null!=e.data){const a=e.data.token?e.data.token:e.data.authorization;k.refreshToken(a);const r={id:e.data.id,name:e.data.name,role:x.role};P.setUser(r),y.clearUsername(),j.replace({name:"gradeManagement"})}else{I.value="fail";const a="账号不存在"===e.msg?"id":"password";U.value?.validate([a])}}catch(e){}}return(e,a)=>{const r=c("a-typography-title"),t=c("a-input"),s=c("a-form-item"),o=c("a-input-password"),l=c("a-radio-button"),i=c("a-radio-group"),n=c("a-flex"),d=c("a-button"),u=c("a-form");return v(),m("div",b,[f(n,{justify:"center",align:"center",vertical:!0,style:{height:"100%"}},{default:p((()=>[f(r,{level:2},{default:p((()=>a[6]||(a[6]=[_("登录")]))),_:1,__:[6]}),f(u,{ref_key:"formRef",ref:U,model:x,rules:B,name:"normal_login",class:"login-form",onFinish:z},{default:p((()=>[f(s,{label:"账户",name:"id",onChange:a[1]||(a[1]=()=>w(y).setUsername(x.id)),onBlur:a[2]||(a[2]=()=>I.value="idle")},{default:p((()=>[f(t,{value:x.id,"onUpdate:value":a[0]||(a[0]=e=>x.id=e)},{prefix:p((()=>[f(w(g),{class:"site-form-item-icon"})])),_:1},8,["value"])])),_:1}),f(s,{label:"密码",name:"password"},{default:p((()=>[f(o,{value:x.password,"onUpdate:value":a[3]||(a[3]=e=>x.password=e),onBlur:a[4]||(a[4]=()=>I.value="idle")},{prefix:p((()=>[f(w(h),{class:"site-form-item-icon"})])),_:1},8,["value"])])),_:1}),f(s,{name:"role"},{default:p((()=>[f(n,{justify:"center",align:"center",vertical:!0},{default:p((()=>[f(i,{value:x.role,"onUpdate:value":a[5]||(a[5]=e=>x.role=e)},{default:p((()=>[f(l,{value:"student"},{default:p((()=>a[7]||(a[7]=[_("学生登录")]))),_:1,__:[7]}),f(l,{value:"teacher"},{default:p((()=>a[8]||(a[8]=[_("教师登录")]))),_:1,__:[8]})])),_:1},8,["value"])])),_:1})])),_:1}),f(s,null,{default:p((()=>[f(d,{disabled:E.value,type:"primary","html-type":"submit",style:{width:"100%"}},{default:p((()=>a[9]||(a[9]=[_(" 登录 ")]))),_:1,__:[9]},8,["disabled"])])),_:1})])),_:1},8,["model"])])),_:1})],512)}}}),[["__scopeId","data-v-fa9695a5"]]);export{y as default};
